import express from "express";
import Shopify from "shopify-api-node";
import path from "path";
import { fileURLToPath } from "url";


const router = express.Router();


// For resolving template path
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);


// Shopify API setup (You will add real keys in Render environment variables)
const shopify = new Shopify({
shopName: process.env.SHOP_NAME,
apiKey: process.env.SHOPIFY_API_KEY,
password: process.env.SHOPIFY_API_PASSWORD
});


// ---------- Generate GST Invoice for a given order ID ----------
router.get("/invoice/:id", async (req, res) => {
try {
const orderId = req.params.id;


// Fetch order from Shopify
const order = await shopify.order.get(orderId);


// Render invoice template
res.render("invoice-template", {
order: order,
gst: {
gstin: process.env.GSTIN || "27ABCDE1234F1Z5",
address: process.env.BILLING_ADDRESS || "Your Business Address",
state: process.env.STATE || "Maharashtra",
stateCode: process.env.STATE_CODE || "27"
}
});
} catch (error) {
console.error(error);
res.status(500).send("Error generating invoice");
}
});


export default router;